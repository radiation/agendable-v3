{% extends "base.html" %}

{% block title %}Agendable — {{ series.title }}{% endblock %}

{% block content %}
<p><a href="/">← Back</a></p>

<section>
    <h2>{{ series.title }}</h2>
    <p><small>Repeats: {{ recurrence_label }}</small></p>
    <p><small>Reminder lead: {{ series.reminder_minutes_before }} minutes before</small></p>
    {% if active_occurrence %}
    <p><a href="/occurrences/{{ active_occurrence.id }}"><strong>Open active meeting</strong></a></p>
    {% endif %}
</section>

<hr />

<section>
    <h3>Meetings</h3>
    {% set display_tz = series.recurrence_timezone if series.recurrence_timezone else current_user.timezone %}

    <form method="post" action="/series/{{ series.id }}/occurrences"
        style="display:flex; gap: .5rem; flex-wrap: wrap; align-items: end;">
        <label>
            Scheduled at (UTC)
            <input name="scheduled_at" type="datetime-local" required />
        </label>
        <button type="submit">Add meeting</button>
    </form>

    <ul>
        {% for o in occurrences %}
        <li>
            <a href="/occurrences/{{ o.id }}">{{ o.scheduled_at|format_dt(display_tz) }}</a>
            {% if active_occurrence and o.id == active_occurrence.id %}
            <strong>(active)</strong>
            {% endif %}
        </li>
        {% else %}
        <li><em>No meetings yet. Add one above to start capturing agenda and tasks.</em></li>
        {% endfor %}
    </ul>
</section>
{% endblock %}